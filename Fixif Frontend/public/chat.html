<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>Fixif.ai ¬∑ Vehicle AI Diagnosis Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    /* ===========================
       THEME TOKENS (BLACK & WHITE)
       =========================== */

    html[data-theme="light"] {
      --bg: #f4f4f5;
      --bg-alt: #ffffff;
      --bg-soft: #e5e5e5;
      --border-subtle: rgba(148, 148, 148, 0.4);

      --text: #111111;
      --text-muted: #4b4b4b;
      --text-soft: #9f9f9f;
      --text-on-accent: #f9f9f9;

      --accent: #2f2f2f;
      --accent-soft: rgba(47, 47, 47, 0.08);
      --accent-strong: #000000;

      --shadow-soft: 0 18px 45px rgba(15, 15, 15, 0.16);
      --shadow-elevated: 0 22px 55px rgba(15, 15, 15, 0.25);

      --header-blur-bg: rgba(249, 249, 249, 0.94);
      --hero-gradient: radial-gradient(circle at top, #e5e5e5 0%, #f9f9f9 38%, #f9f9f9 100%);
    }

    html[data-theme="dark"] {
      --bg: #050505;
      --bg-alt: #050505;
      --bg-soft: #111111;
      --border-subtle: rgba(148, 148, 148, 0.35);

      --text: #f5f5f5;
      --text-muted: #d4d4d4;
      --text-soft: #9f9f9f;
      --text-on-accent: #050505;

      --accent: #e5e5e5;
      --accent-soft: rgba(229, 229, 229, 0.06);
      --accent-strong: #ffffff;

      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.9);
      --shadow-elevated: 0 24px 65px rgba(0, 0, 0, 1);

      --header-blur-bg: rgba(5, 5, 5, 0.92);
      --hero-gradient: radial-gradient(circle at top, #050505 0%, #050505 40%, #050505 100%);
    }

    /* Fallback if JS hasn't run yet (match dark mode) */
    html {
      --bg: #050505;
      --bg-alt: #050505;
      --bg-soft: #111111;
      --border-subtle: rgba(148, 148, 148, 0.35);

      --text: #f5f5f5;
      --text-muted: #d4d4d4;
      --text-soft: #9f9f9f;
      --text-on-accent: #050505;

      --accent: #e5e5e5;
      --accent-soft: rgba(229, 229, 229, 0.06);
      --accent-strong: #ffffff;

      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.9);
      --shadow-elevated: 0 24px 65px rgba(0, 0, 0, 1);

      --header-blur-bg: rgba(5, 5, 5, 0.92);
      --hero-gradient: radial-gradient(circle at top, #050505 0%, #050505 40%, #050505 100%);
    }

    :root {
      --radius-lg: 1.25rem;
      --radius-md: 0.75rem;
      --radius-sm: 0.5rem;
      --radius-pill: 999px;

      --header-height: 72px;
      --content-max-width: 1120px;
    }

    /* ===========================
       GLOBAL
       =========================== */

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    h1,
    h2,
    h3,
    h4 {
      margin: 0;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    p {
      margin: 0;
      line-height: 1.7;
    }

    a {
      color: inherit;
    }

    .container {
      max-width: var(--content-max-width);
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    main {
      flex: 1;
    }

    /* ===========================
       HEADER & NAV
       =========================== */

    .site-header {
      position: sticky;
      top: 0;
      z-index: 40;
      backdrop-filter: blur(18px);
      background: var(--header-blur-bg);
      border-bottom: 1px solid var(--border-subtle);
    }

    .header-inner {
      height: var(--header-height);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.25rem;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      text-decoration: none;
    }

    .brand-mark {
      width: 32px;
      height: 32px;
      border-radius: 0.9rem;
      background: radial-gradient(circle at 0 0, var(--accent), var(--accent-strong));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 0.9rem;
      color: var(--text-on-accent);
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.8), 0 0 24px rgba(0, 0, 0, 0.45);
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 0.05rem;
    }

    .brand-name {
      text-transform: uppercase;
      font-size: 0.9rem;
      letter-spacing: 0.18em;
    }

    .brand-tagline {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .site-nav {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .nav-link {
      text-decoration: none;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
      position: relative;
      padding-bottom: 0.2rem;
    }

    .nav-link::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -0.25rem;
      width: 0;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(to right, var(--accent), var(--accent-strong));
      transition: width 0.16s ease;
    }

    .nav-link:hover::after {
      width: 100%;
    }

    .nav-link.is-active {
      color: var(--accent-strong);
    }

    .nav-link.is-active::after {
      width: 100%;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .theme-toggle {
      border-radius: var(--radius-pill);
      padding: 0.35rem 0.9rem;
      border: 1px solid var(--border-subtle);
      background: var(--bg-soft);
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.78rem;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text);
    }

    .theme-toggle-icon,
    .theme-toggle-label {
      color: inherit;
    }

    html[data-theme="dark"] .theme-toggle {
      color: #ffffff;
    }

    .theme-toggle-icon {
      font-size: 0.9rem;
    }

    .nav-toggle {
      display: none;
      width: 38px;
      height: 38px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: var(--bg-soft);
      padding: 0;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 5px;
    }

    .nav-toggle span {
      width: 16px;
      height: 2px;
      border-radius: 999px;
      background: var(--text-muted);
    }

    /* ===========================
       HERO
       =========================== */

    .hero {
      background: var(--hero-gradient);
      position: relative;
      overflow: hidden;
      padding: 4.5rem 0 4rem;
    }

    .hero-inner {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 3rem;
      align-items: center;
    }

    .hero-badge {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--accent-strong);
      margin-bottom: 0.75rem;
    }

    .hero-title {
      font-size: clamp(2.4rem, 4vw, 3.1rem);
      margin-bottom: 0.75rem;
    }

    .hero-title span {
      color: var(--accent-strong);
    }

    .hero-text {
      color: var(--text-muted);
      max-width: 34rem;
      margin-bottom: 1.35rem;
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .hero-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .hero-stat-label {
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .hero-stat-value {
      font-size: 1rem;
      font-weight: 600;
    }

    .hero-visual {
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-elevated);
      padding: 1rem;
      background: radial-gradient(circle at top, var(--accent-soft), var(--bg-alt));
    }

    .hero-visual-inner {
      border-radius: 0.9rem;
      overflow: hidden;
      position: relative;
      background: linear-gradient(to bottom right, rgba(0,0,0,0.96), rgba(0,0,0,0.92));
    }

    .hero-car {
      height: 230px;
      background-image: url("https://images.pexels.com/photos/112460/pexels-photo-112460.jpeg?auto=compress&cs=tinysrgb&w=1600");
      background-size: cover;
      background-position: center;
      filter: grayscale(1) contrast(1.05);
    }

    .hero-overlay-card {
      position: absolute;
      right: 1rem;
      bottom: 1rem;
      border-radius: 0.75rem;
      background: rgba(0,0,0,0.9);
      border: 1px solid rgba(148,148,148,0.6);
      padding: 0.8rem 0.9rem;
      max-width: 260px;
      font-size: 0.8rem;
      color: #f3f3f3;
    }

    /* Section */

    .section {
      padding: 2.4rem 0;
    }

    .section--border-top {
      border-top: 1px solid var(--border-subtle);
    }

    .section-header {
      margin-bottom: 1.6rem;
    }

    .section-kicker {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--accent-strong);
      margin-bottom: 0.35rem;
    }

    .section-title {
      font-size: 1.6rem;
      margin-bottom: 0.4rem;
    }

    .section-subtitle {
      max-width: 36rem;
      color: var(--text-muted);
    }

    /* Cards & grids */

    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 1.5rem;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 2rem;
    }

    .card {
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      background: var(--bg-alt);
      padding: 1.2rem 1.25rem;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
    }

    .btn {
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-subtle);
      padding: 0.6rem 1.4rem;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      cursor: pointer;
      background: var(--bg-alt);
      color: var(--text);
      text-decoration: none;
    }

    .btn-primary {
      background: linear-gradient(to right, var(--accent), var(--accent-strong));
      border-color: transparent;
      color: var(--text-on-accent);
      box-shadow: 0 14px 32px rgba(0, 0, 0, 0.32);
    }

    .btn-ghost {
      background: var(--bg-alt);
    }

    .btn-soft {
      border-radius: var(--radius-pill);
      border: 1px dashed var(--border-subtle);
      padding: 0.45rem 1rem;
      font-size: 0.78rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      background: var(--bg-soft);
      color: var(--text-soft);
      cursor: pointer;
    }

    /* Footer */

    .site-footer {
      border-top: 1px solid var(--border-subtle);
      padding: 1.6rem 0;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .footer-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .footer-links {
      display: flex;
      gap: 1.25rem;
    }

    .footer-links a {
      text-decoration: none;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    /* ===========================
       RESPONSIVE
       =========================== */

    @media (max-width: 960px) {
      .hero-inner {
        grid-template-columns: minmax(0, 1fr);
      }

      .hero-visual {
        order: -1;
        margin-bottom: 2rem;
      }

      .grid-3 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 768px) {
      .site-nav {
        position: absolute;
        inset: var(--header-height) 0 auto 0;
        background: var(--header-blur-bg);
        border-bottom: 1px solid var(--border-subtle);
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
        padding: 0.8rem 1.5rem 1rem;
        transform: translateY(-140%);
        opacity: 0;
        pointer-events: none;
        transition: transform 0.16s ease-out, opacity 0.16s ease-out;
      }

      .site-nav.is-open {
        transform: translateY(0);
        opacity: 1;
        pointer-events: auto;
      }

      .nav-toggle {
        display: inline-flex;
      }

      .header-inner {
        padding-inline: 1.2rem;
      }

      .grid-3 {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* ===========================
       CHAT PAGE STYLES
       =========================== */

    .chat-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 1.5rem;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .chat-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .chat-card {
      padding: 1.1rem 1.2rem 1.25rem;
    }

    fieldset {
      border: none;
      padding: 0;
      margin: 0 0 1rem;
    }

    label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
    }

    input,
    textarea,
    select {
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      padding: 0.55rem 0.7rem;
      background: var(--bg);
      color: var(--text);
      font-size: 0.9rem;
      outline: none;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.25);
    }

    .chat-section-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-soft);
      margin-bottom: 0.35rem;
    }

    .step-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 1.4rem;
      height: 1.4rem;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--text-soft);
    }

    .optional-tag {
      font-size: 0.7rem;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .chat-actions-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      margin-top: 0.35rem;
    }

    .chat-actions-row small {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .chat-actions-buttons {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .status {
      margin-top: 0.6rem;
      font-size: 0.78rem;
    }

    .status.error {
      color: #fecaca;
      background: rgba(248, 113, 113, 0.08);
      border-radius: var(--radius-md);
      padding: 0.45rem 0.6rem;
      border: 1px solid rgba(248, 113, 113, 0.35);
    }

    .status.loading {
      color: var(--accent-strong);
    }

    .result-placeholder {
      font-size: 0.82rem;
      color: var(--text-soft);
    }

    .result-block {
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      background: var(--bg);
      padding: 0.7rem 0.85rem;
      margin-bottom: 0.7rem;
    }

    .result-block h3 {
      font-size: 0.9rem;
      margin: 0 0 0.3rem;
    }

    .result-text {
      font-size: 0.9rem;
      color: var(--text-muted);
      line-height: 1.6;
    }

    .cause-item,
    .part-item {
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      background: var(--bg-alt);
      padding: 0.5rem 0.6rem;
      margin-bottom: 0.45rem;
    }

    .cause-header,
    .part-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 0.25rem;
    }

    .pill {
      border-radius: 999px;
      padding: 0.1rem 0.55rem;
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      border: 1px solid var(--border-subtle);
      color: var(--text-soft);
    }

    .pill-urgency {
      border-color: rgba(148,148,148,0.7);
      color: var(--accent-strong);
    }

    .pill-likelihood {
      border-color: rgba(148,148,148,0.7);
      color: var(--text-muted);
    }

    .list {
      padding-left: 1rem;
      margin: 0;
    }

    .list li {
      font-size: 0.88rem;
      margin-bottom: 0.15rem;
      color: var(--text-muted);
    }

    .result-warning {
      border-radius: var(--radius-md);
      border: 1px solid rgba(245, 158, 11, 0.7);
      background: rgba(245, 158, 11, 0.12);
      padding: 0.6rem 0.75rem;
      margin-bottom: 0.6rem;
      font-size: 0.88rem;
      color: #fde68a;
    }

    .result-meta {
      margin-top: 0.5rem;
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 0.78rem;
      background: var(--bg);
      padding: 0.6rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      max-height: 260px;
      overflow: auto;
    }

    details.more-block {
      border-radius: var(--radius-md);
      border: 1px dashed var(--border-subtle);
      background: var(--bg-soft);
      padding: 0.55rem 0.75rem;
      margin-top: 0.5rem;
    }

    details.more-block summary {
      list-style: none;
      cursor: pointer;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    details.more-block summary::-webkit-details-marker {
      display: none;
    }

    details.more-block summary::after {
      content: "+";
      font-size: 0.9rem;
    }

    details.more-block[open] summary::after {
      content: "‚Äì";
    }

    .more-block-inner {
      margin-top: 0.5rem;
      display: grid;
      gap: 0.75rem;
    }

    @media (max-width: 768px) {
      .chat-actions-row {
        flex-direction: column;
        align-items: flex-start;
      }

      .chat-actions-buttons {
        width: 100%;
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- HEADER -->
    <header class="site-header">
      <div class="container header-inner">
        <a href="index.html" class="brand">
          <div class="brand-mark">Fx</div>
          <div class="brand-text">
            <div class="brand-name">FIXIF.AI</div>
            <div class="brand-tagline">Vehicle issue intake &amp; triage</div>
          </div>
        </a>

        <nav class="site-nav" id="site-nav">
          <a href="index.html" class="nav-link">Home</a>
          <a href="chat.html" class="nav-link is-active">AI Assistant</a>
          <a href="login.html" class="nav-link" id="logoutLink">Logout</a>
        </nav>

        <div class="header-actions">
          <button class="theme-toggle" id="theme-toggle" type="button">
            <span class="theme-toggle-icon" id="theme-toggle-icon">üåô</span>
            <span class="theme-toggle-label" id="theme-toggle-label">Dark</span>
          </button>
          <button class="nav-toggle" id="nav-toggle" type="button" aria-label="Toggle navigation">
            <span></span><span></span><span></span>
          </button>
        </div>
      </div>
    </header>

    <main>
      <!-- HERO -->
      <section class="hero">
        <div class="container hero-inner">
          <div>
            <div class="hero-badge">AI SERVICE INTAKE ¬∑ LIVE DEMO</div>
            <h1 class="hero-title">
              Turn noisy car complaints into a
              <span>clean diagnosis plan.</span>
            </h1>
            <p class="hero-text">
              Fixif.ai helps you capture customer and vehicle details, then uses AI to draft a
              mechanic-friendly summary, probable causes, DIY checks, workshop actions,
              safety notes, and a preliminary parts list.
            </p>
            <div class="hero-actions">
              <a href="#assistant" class="btn btn-primary">Try the AI assistant</a>
              <a href="index.html" class="btn btn-ghost">Back to main site</a>
            </div>
            <div class="hero-meta">
              <div>
                <div class="hero-stat-label">Built for</div>
                <div class="hero-stat-value">Workshops &amp; service advisors</div>
              </div>
              <div>
                <div class="hero-stat-label">Output</div>
                <div class="hero-stat-value">Summary ¬∑ Causes ¬∑ Parts</div>
              </div>
            </div>
          </div>

          <aside class="hero-visual">
            <div class="hero-visual-inner">
              <div class="hero-car"></div>
              <div class="hero-overlay-card">
                <strong>Example intake</strong>
                <p style="margin-top: 0.35rem;">
                  ‚ÄúEngine makes a knocking sound on cold start, check engine light sometimes turns on,
                  and fuel consumption is higher than usual.‚Äù
                </p>
                <p style="margin-top: 0.5rem; font-size:0.78rem; color:#e5e5e5;">
                  AI returns a structured summary, ranked causes, quick checks, workshop steps,
                  safety warnings, and parts to quote.
                </p>
              </div>
            </div>
          </aside>
        </div>
      </section>

      <!-- ASSISTANT SECTION -->
      <section class="section section--border-top" id="assistant">
        <div class="container">
          <div class="section-header">
            <div class="section-kicker">Interactive workspace</div>
            <h2 class="section-title">AI intake &amp; diagnosis assistant</h2>
            <p class="section-subtitle">
              Just fill in the basics, describe the symptoms, and let Fixif.ai generate a structured, mechanic-ready plan.
              Extra fields are optional and tucked away so the form stays clean.
            </p>
          </div>

          <div class="chat-layout">
            <!-- LEFT: FORM -->
            <section class="card chat-card">
              <form id="diagnosisForm">
                <!-- Step 1: Customer Details -->
                <fieldset>
                  <div class="chat-section-label">
                    <span class="step-badge">1</span>
                    <span>Customer details</span>
                  </div>
                  <div style="display:flex; flex-direction:column; gap:0.9rem;">
                    <div>
                      <label for="fullName">Full Name</label>
                      <input
                        type="text"
                        id="fullName"
                        name="fullName"
                        required
                        placeholder="Customer full name"
                      />
                    </div>
                    <div>
                      <label for="phonePrimary">Mobile Number</label>
                      <input
                        type="text"
                        id="phonePrimary"
                        name="phonePrimary"
                        placeholder="Primary contact number"
                      />
                    </div>

                    <details class="more-block">
                      <summary>
                        More customer details
                        <span class="optional-tag">Optional</span>
                      </summary>
                      <div class="more-block-inner">
                        <div>
                          <label for="phoneAlternate">Alternate Number</label>
                          <input
                            type="text"
                            id="phoneAlternate"
                            name="phoneAlternate"
                            placeholder="Backup contact (optional)"
                          />
                        </div>
                        <div>
                          <label for="email">Email</label>
                          <input
                            type="email"
                            id="email"
                            name="email"
                            placeholder="For invoice / updates"
                          />
                        </div>
                        <div>
                          <label for="preferredContactMethod">Preferred Contact</label>
                          <select id="preferredContactMethod" name="preferredContactMethod">
                            <option value="text">Text</option>
                            <option value="call">Call</option>
                            <option value="email">Email</option>
                          </select>
                        </div>
                        <div>
                          <label for="address">Home Address</label>
                          <textarea
                            id="address"
                            name="address"
                            rows="2"
                            placeholder="For invoices or warranty records"
                          ></textarea>
                        </div>
                      </div>
                    </details>
                  </div>
                </fieldset>

                <!-- Step 2: Vehicle Details -->
                <fieldset>
                  <div class="chat-section-label">
                    <span class="step-badge">2</span>
                    <span>Vehicle details</span>
                  </div>
                  <div style="display:flex; flex-direction:column; gap:0.9rem;">
                    <div class="grid-2" style="gap:0.9rem;">
                      <div>
                        <label for="year">Year</label>
                        <input
                          type="number"
                          id="year"
                          name="year"
                          placeholder="e.g. 2015"
                        />
                      </div>
                      <div>
                        <label for="make">Make</label>
                        <input
                          type="text"
                          id="make"
                          name="make"
                          placeholder="e.g. Toyota, Honda"
                        />
                      </div>
                    </div>
                    <div>
                      <label for="model">Model</label>
                      <input
                        type="text"
                        id="model"
                        name="model"
                        placeholder="e.g. Vios 1.3 E"
                      />
                    </div>
                    <div>
                      <label for="engineOrTransmission">Engine / Transmission</label>
                      <input
                        type="text"
                        id="engineOrTransmission"
                        name="engineOrTransmission"
                        placeholder="e.g. 1.3L Gasoline A/T"
                      />
                    </div>
                    <div>
                      <label for="mileage">Odometer (km)</label>
                      <input
                        type="number"
                        id="mileage"
                        name="mileage"
                        placeholder="Approximate mileage"
                      />
                    </div>

                    <details class="more-block">
                      <summary>
                        More vehicle details
                        <span class="optional-tag">Optional</span>
                      </summary>
                      <div class="more-block-inner">
                        <div>
                          <label for="color">Color</label>
                          <input
                            type="text"
                            id="color"
                            name="color"
                            placeholder="e.g. Silver"
                          />
                        </div>
                        <div>
                          <label for="vin">VIN</label>
                          <input
                            type="text"
                            id="vin"
                            name="vin"
                            placeholder="Vehicle Identification Number"
                          />
                        </div>
                        <div>
                          <label for="plate">Plate Number</label>
                          <input
                            type="text"
                            id="plate"
                            name="plate"
                            placeholder="License plate"
                          />
                        </div>
                        <div>
                          <label for="dropOffDateTime">Drop-off Date/Time</label>
                          <input
                            type="datetime-local"
                            id="dropOffDateTime"
                            name="dropOffDateTime"
                          />
                        </div>
                      </div>
                    </details>
                  </div>
                </fieldset>

                <!-- Step 3: Symptoms -->
                <fieldset>
                  <div class="chat-section-label">
                    <span class="step-badge">3</span>
                    <span>Symptoms &amp; notes</span>
                  </div>
                  <div style="display:flex;flex-direction:column;gap:0.75rem;">
                    <div>
                      <label for="symptoms">Describe the symptoms</label>
                      <textarea
                        id="symptoms"
                        name="symptoms"
                        rows="4"
                        required
                        placeholder="Example: Engine makes a knocking sound on cold start for 2‚Äì3 minutes, check engine light sometimes turns on, fuel consumption is higher than usual..."
                      ></textarea>
                    </div>
                    <div>
                      <label for="additionalNotes">Story / context (optional)</label>
                      <textarea
                        id="additionalNotes"
                        name="additionalNotes"
                        rows="2"
                        placeholder="When did this start? After a long drive, flood, or repair? Any warning lights or smells?"
                      ></textarea>
                    </div>
                  </div>
                </fieldset>

                <!-- AI Preferences -->
                <fieldset>
                  <div class="chat-section-label">
                    <span class="step-badge">4</span>
                    <span>AI output style</span>
                  </div>
                  <div class="grid-3" style="gap: 0.9rem;">
                    <div>
                      <label for="detailLevel">Detail Level</label>
                      <select id="detailLevel" name="detailLevel">
                        <option value="brief">Brief</option>
                        <option value="normal" selected>Normal</option>
                        <option value="detailed">Detailed</option>
                      </select>
                    </div>
                    <div>
                      <label for="language">Language</label>
                      <select id="language" name="language">
                        <option value="English" selected>English</option>
                        <option value="Taglish">Taglish</option>
                      </select>
                    </div>
                    <div>
                      <label for="tone">Tone</label>
                      <select id="tone" name="tone">
                        <option value="friendly, non-technical but honest" selected>
                          Friendly &amp; simple
                        </option>
                        <option value="professional, service-advisor style">
                          Professional
                        </option>
                        <option value="detailed, technical but still clear">
                          More technical
                        </option>
                      </select>
                    </div>
                  </div>
                </fieldset>

                <!-- Actions -->
                <div class="chat-actions-row">
                  <small>
                    AI assistant only. Final diagnosis and road-worthiness must be checked by a licensed mechanic.
                  </small>
                  <div class="chat-actions-buttons">
                    <button type="button" class="btn-soft" id="demoBtn">Use demo data</button>
                    <button type="button" class="btn btn-ghost" id="clearBtn">Clear</button>
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                      Generate AI Diagnosis
                    </button>
                  </div>
                </div>

                <div id="status" class="status"></div>
              </form>
            </section>

            <!-- RIGHT: RESULT -->
            <section class="card chat-card">
              <div class="chat-section-label">
                <span class="step-badge">‚ñ∂</span>
                <span>AI diagnosis result</span>
              </div>
              <div id="resultContainer">
                <p class="result-placeholder">
                  Fill out the basics on the left and click <strong>Generate AI Diagnosis</strong> to see
                  the summary, causes, DIY checks, workshop actions, safety notes, and parts needed.
                </p>
              </div>
            </section>
          </div>
        </div>
      </section>
    </main>

    <!-- FOOTER -->
    <footer class="site-footer">
      <div class="container footer-inner">
        <span>¬© <span id="year"></span> Fixif.ai ¬∑ GGH Software.</span>
        <div class="footer-links">
          <a href="index.html">Home</a>
          <a href="#assistant">Assistant</a>
        </div>
      </div>
    </footer>
  </div>

  <!-- SweetAlert2 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    // ===== Theme + nav toggles =====
    const root = document.documentElement;
    const themeToggle = document.getElementById('theme-toggle');
    const themeLabel = document.getElementById('theme-toggle-label');
    const themeIcon = document.getElementById('theme-toggle-icon');
    const navToggle = document.getElementById('nav-toggle');
    const nav = document.getElementById('site-nav');
    const logoutLink = document.getElementById('logoutLink');

    // Match your backend URL
    const API_BASE_URL = 'http://localhost:4000';

    const savedTheme = localStorage.getItem('fixif-theme');
    if (savedTheme === 'light' || savedTheme === 'dark') {
      root.setAttribute('data-theme', savedTheme);
    } else {
      root.setAttribute('data-theme', 'dark');
    }

    function updateThemeUI() {
      const current = root.getAttribute('data-theme') || 'dark';
      if (current === 'dark') {
        themeLabel.textContent = 'Dark';
        themeIcon.textContent = 'üåô';
      } else {
        themeLabel.textContent = 'Light';
        themeIcon.textContent = '‚òÄÔ∏è';
      }
    }
    updateThemeUI();

    themeToggle.addEventListener('click', () => {
      const current = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      root.setAttribute('data-theme', current);
      localStorage.setItem('fixif-theme', current);
      updateThemeUI();
    });

    navToggle.addEventListener('click', () => {
      nav.classList.toggle('is-open');
    });

    document.getElementById('year').textContent = new Date().getFullYear();

    // ===== LOGOUT HANDLER WITH SWEETALERT CONFIRMATION =====
    if (logoutLink) {
      logoutLink.addEventListener('click', async (e) => {
        e.preventDefault();

        const result = await Swal.fire({
          title: 'Log out?',
          text: 'You will need to log in again to use the AI assistant.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, log out',
          cancelButtonText: 'Cancel',
          reverseButtons: true,
        });

        if (!result.isConfirmed) {
          return;
        }

        const token = localStorage.getItem('fixifToken');

        if (token) {
          try {
            await fetch(API_BASE_URL + '/api/auth/logout', {
              method: 'POST',
              headers: {
                Authorization: 'Bearer ' + token,
              },
            });
          } catch (err) {
            console.warn('Logout API call failed (ignored):', err);
          }
        }

        localStorage.removeItem('fixifToken');
        localStorage.removeItem('fixifUser');

        window.location.href = 'login.html';
      });
    }

    // ===== AI DIAGNOSIS LOGIC =====
    const form = document.getElementById('diagnosisForm');
    const statusEl = document.getElementById('status');
    const resultContainer = document.getElementById('resultContainer');
    const submitBtn = document.getElementById('submitBtn');
    const clearBtn = document.getElementById('clearBtn');
    const demoBtn = document.getElementById('demoBtn');

    function setStatus(message, type) {
      statusEl.textContent = message || '';
      statusEl.className = 'status';
      if (!message) return;
      if (type === 'error') statusEl.classList.add('error');
      if (type === 'loading') statusEl.classList.add('loading');
    }

    function clearResult() {
      resultContainer.innerHTML =
        '<p class="result-placeholder">Fill out the basics and click <strong>Generate AI Diagnosis</strong> to see the AI output.</p>';
    }

    function renderResult(data) {
      if (!data) {
        clearResult();
        return;
      }
      if (!data.ai && data.rawText) {
        resultContainer.innerHTML =
          '<div class="result-warning">AI did not return valid JSON. Showing raw output for debugging.</div>' +
          '<pre>' + (data.rawText || '') + '</pre>';
        return;
      }
      if (!data.ai) {
        clearResult();
        return;
      }

      const ai = data.ai;
      let html = '';

      if (ai.summary) {
        html += `
          <div class="result-block">
            <h3>Summary</h3>
            <div class="result-text">${ai.summary}</div>
          </div>
        `;
      }

      if (Array.isArray(ai.probableCauses) && ai.probableCauses.length > 0) {
        html += `<div class="result-block"><h3>Probable Causes</h3>`;
        ai.probableCauses.forEach((c) => {
          html += `
            <div class="cause-item">
              <div class="cause-header">
                <span style="font-size:0.9rem;font-weight:600;">${c.title || ''}</span>
                <span class="pill pill-likelihood">${(c.likelihood || 'unspecified').toUpperCase()}</span>
              </div>
              <div class="result-text">${c.explanation || ''}</div>
            </div>
          `;
        });
        html += `</div>`;
      }

      if (Array.isArray(ai.immediateChecks) && ai.immediateChecks.length > 0) {
        html += `
          <div class="result-block">
            <h3>Immediate Checks / DIY Tips</h3>
            <ul class="list">
        `;
        ai.immediateChecks.forEach((item) => {
          html += `<li>${item}</li>`;
        });
        html += `</ul></div>`;
      }

      if (Array.isArray(ai.recommendedActions) && ai.recommendedActions.length > 0) {
        html += `
          <div class="result-block">
            <h3>Recommended Actions (Workshop)</h3>
            <ol class="list">
        `;
        ai.recommendedActions.forEach((item) => {
          html += `<li>${item}</li>`;
        });
        html += `</ol></div>`;
      }

      if (Array.isArray(ai.safetyNotes) && ai.safetyNotes.length > 0) {
        html += `
          <div class="result-warning">
            <strong>Safety Notes:</strong>
            <ul class="list" style="margin-top:4px;">
        `;
        ai.safetyNotes.forEach((item) => {
          html += `<li>${item}</li>`;
        });
        html += `</ul></div>`;
      }

      if (Array.isArray(ai.partsNeeded) && ai.partsNeeded.length > 0) {
        html += `
          <div class="result-block" style="border-color:rgba(148,148,148,0.7);">
            <h3>Parts Needed (Preliminary)</h3>
        `;
        ai.partsNeeded.forEach((p) => {
          html += `
            <div class="part-item">
              <div class="part-header">
                <span style="font-size:0.9rem;font-weight:600;">
                  ${p.partName || ''}
                </span>
                <span class="pill pill-urgency">${(p.urgency || '').toUpperCase()}</span>
              </div>
              <div class="result-text" style="font-size:0.86rem;">
                OEM/Aftermarket: <strong>${p.oemOrAftermarket || 'unspecified'}</strong>
              </div>
              ${p.notes ? `<div class="result-text" style="font-size:0.86rem;margin-top:2px;">Notes: ${p.notes}</div>` : ''}
            </div>
          `;
        });
        html += `</div>`;
      }

      if (data.meta && data.meta.model) {
        const dateStr = data.meta.createdAt
          ? new Date(data.meta.createdAt).toLocaleString()
          : '';
        html += `
          <div class="result-meta">
            Generated by ${data.meta.model}${dateStr ? ' ¬∑ ' + dateStr : ''}
          </div>
        `;
      }

      resultContainer.innerHTML = html || '<p class="result-placeholder">No data.</p>';
    }

    // If not logged in, redirect to login
    (function ensureLoggedIn() {
      const token = localStorage.getItem('fixifToken');
      if (!token) {
        window.location.href = 'login.html';
      }
    })();

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      setStatus('', '');
      clearResult();

      const symptoms = form.symptoms.value.trim();
      if (!symptoms) {
        setStatus('Please describe the symptoms.', 'error');
        return;
      }

      const token = localStorage.getItem('fixifToken');
      if (!token) {
        setStatus('Session expired. Please log in again.', 'error');
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 800);
        return;
      }

      submitBtn.disabled = true;
      clearBtn.disabled = true;
      demoBtn.disabled = true;
      setStatus('Analyzing‚Ä¶ thinking like a senior mechanic.', 'loading');

      const payload = {
        customer: {
          fullName: form.fullName.value.trim(),
          phonePrimary: form.phonePrimary.value.trim(),
          phoneAlternate: form.phoneAlternate.value.trim(),
          email: form.email.value.trim(),
          address: form.address.value.trim(),
          preferredContactMethod: form.preferredContactMethod.value,
        },
        vehicle: {
          year: form.year.value,
          make: form.make.value.trim(),
          model: form.model.value.trim(),
          vin: form.vin.value.trim(),
          plate: form.plate.value.trim(),
          mileage: form.mileage.value,
          engineOrTransmission: form.engineOrTransmission.value.trim(),
          color: form.color.value.trim(),
          dropOffDateTime: form.dropOffDateTime.value,
        },
        complaint: {
          symptoms: symptoms,
          additionalNotes: form.additionalNotes.value.trim(),
        },
        preferences: {
          detailLevel: form.detailLevel.value,
          language: form.language.value,
          tone: form.tone.value,
        },
      };

      try {
        const res = await fetch(API_BASE_URL + '/api/diagnose', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: 'Bearer ' + token,
          },
          body: JSON.stringify(payload),
        });

        const raw = await res.text();
        let data;

        try {
          data = JSON.parse(raw);
        } catch (jsonErr) {
          console.error('‚ùå Failed to parse JSON from /api/diagnose. Raw response:', raw);
          setStatus('Server responded with invalid JSON.', 'error');
          renderResult(null);
          return;
        }

        if (!res.ok) {
          const mainMsg = data && data.error ? data.error : 'Failed to get AI response.';
          const details = data && data.details ? ` (${data.details})` : '';
          setStatus(mainMsg + details, 'error');
          renderResult(null);
        } else {
          setStatus('', '');
          renderResult(data);
        }
      } catch (err) {
        console.error('‚ùå Network error calling /api/diagnose:', err);
        setStatus('Network error or server unreachable.', 'error');
        renderResult(null);
      } finally {
        submitBtn.disabled = false;
        clearBtn.disabled = false;
        demoBtn.disabled = false;
      }
    });

    clearBtn.addEventListener('click', () => {
      form.reset();
      clearResult();
      setStatus('', '');
    });

    demoBtn.addEventListener('click', () => {
      form.fullName.value = 'Juan Dela Cruz';
      form.phonePrimary.value = '09171234567';
      form.phoneAlternate.value = '09998887777';
      form.email.value = 'juan.delacruz@example.com';
      form.address.value = 'Blk 14 Lot 9, Bellevue Residences, San Jose del Monte, Bulacan';
      form.preferredContactMethod.value = 'text';

      form.year.value = '2015';
      form.make.value = 'Toyota';
      form.model.value = 'Vios 1.3 E';
      form.vin.value = 'JTDB123456789ABCD';
      form.plate.value = 'ABC 1234';
      form.mileage.value = '86500';
      form.engineOrTransmission.value = '1.3L Gasoline A/T';
      form.color.value = 'Silver';
      form.dropOffDateTime.value = '2025-11-23T10:30';

      form.symptoms.value =
        'Engine makes a knocking sound on cold start for 2‚Äì3 minutes, check engine light sometimes turns on, fuel consumption is higher than usual.';
      form.additionalNotes.value =
        'Started around 2 weeks ago after a long trip. Oil change 3 months ago at a generic gas station.';

      setStatus('Demo data filled. You can adjust anything, then click Generate.', '');
      clearResult();
    });

    clearResult();
  </script>
</body>
</html>
